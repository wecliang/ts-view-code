import{c0 as w,q as o,cl as k,bx as J,y as K,c8 as U,bF as L,bG as g,c5 as q,bK as P,bC as G,ci as p,cm as H,bI as S,k as v,b6 as Q,bB as u,an as W,aC as _}from"./index.18d05f4c.js";import"./vendor.0b417fb8.js";var X=Object.defineProperty,Y=Object.defineProperties,Z=Object.getOwnPropertyDescriptors,y=Object.getOwnPropertySymbols,D=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable,j=(e,t,i)=>t in e?X(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,O=(e,t)=>{for(var i in t||(t={}))D.call(t,i)&&j(e,i,t[i]);if(y)for(var i of y(t))E.call(t,i)&&j(e,i,t[i]);return e},ee=(e,t)=>Y(e,Z(t)),C=(e,t)=>{var i={};for(var s in e)D.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(e!=null&&y)for(var s of y(e))t.indexOf(s)<0&&E.call(e,s)&&(i[s]=e[s]);return i};const te="_ExpressionBuilder_9oaxe_1",ie="_header_9oaxe_7",re="_express_9oaxe_15",se="_expressValue_9oaxe_20",ne="_preview_9oaxe_23",ae="_previewValue_9oaxe_28",oe="_title_9oaxe_34",le="_listItem_9oaxe_39",ce="_listDescription_9oaxe_74",de="_selected_9oaxe_78";var c={ExpressionBuilder:te,header:ie,express:re,expressValue:se,preview:ne,previewValue:ae,title:oe,listItem:le,listDescription:ce,selected:de};const N=window.React.useMemo,ue=e=>{var t=e,{$index:i,store:s}=t,a=C(t,["$index","store"]);return S(()=>{const r=N(()=>s.selecteds[i],[s.selecteds]);return o(_,O({size:"small",header:"List title",bordered:!0,render:(n,b)=>{const x=r&&r.id===n.id,f=n.schema&&(n.schema.description||n.schema.title);return v(_.Item,{className:u({[c.selected]:x}),onClick:()=>{s.addSelectedVars(i,n)},children:[o("div",{title:n.field,className:u("ellipsis",c.listName),children:n.field}),f&&o("div",{title:f,className:u("ellipsis",c.listDescription),children:f},n.id)]},n.id)}},a))})},he=e=>{var t=e,{$index:i,store:s}=t,a=C(t,["$index","store"]);return S(()=>{const r=N(()=>s.selecteds[i],[s.selecteds]);return o(_,O({size:"small",header:"List title",bordered:!0,render:(n,b)=>{const x=r&&r.id===n.id,f=n.schema&&(n.schema.description||n.schema.title);return v(_.Item,{className:u({[c.selected]:x}),onClick:()=>{s.addSelectedMethod(i,n)},children:[o("div",{title:n.id,className:u("ellipsis",c.listName),children:n.name}),f&&o("div",{title:f,className:u("ellipsis",c.listDescription),children:f})]},n.id)}},a))})},pe=window.React.useEffect,fe=window.React.useState,me=({store:e})=>S(()=>{const{visible:t,closeDialog:i}=e,[s]=fe(()=>p());function a(r){var n=document.getElementById(s),b=document.getElementById(r);n&&b&&(n.scrollLeft=b.offsetLeft)}return pe(()=>{if(e.buildList.length){const[r]=e.buildList.slice(-1);a(r.id)}},[e.buildList.length]),v(Q,{title:"\u8868\u8FBE\u5F0F\u6784\u5EFA\u5668",className:c.ExpressionBuilder,visible:t,focusLock:!1,onCancel:()=>{e.promise&&e.promise.reject(),i()},style:{width:"90vw"},onOk:()=>{e.promise&&(e.selecteds.length?e.promise.resolve({value:e.expressionText}):e.promise.reject()),i()},children:[o("div",{id:s,className:c.header,children:e.buildList.map((r,n)=>v("div",{id:r.id,className:c.listItem,children:[Boolean(r.varsList.length)&&o(ue,{header:"\u5B58\u50A8\u5E93\u6570\u636E",store:e,$index:n,dataSource:r.varsList}),Boolean(r.methodList&&r.methodList.length)&&o(he,{header:"\u65B9\u6CD5",store:e,$index:n,dataSource:r.methodList})]},n))}),v("div",{className:u("items-center",c.express),children:[o("div",{className:c.title,children:"\u8868\u8FBE\u5F0F"}),o("div",{className:u("ellipsis",c.expressValue),children:e.expressionText})]}),v("div",{className:u("items-center",c.preview),children:[o("div",{className:c.title,children:"\u9884\u89C8"}),o(W,{content:e.dataText,children:o("div",{className:u("items-center","ellipsis",c.previewValue),children:e.dataText})})]})]})});var l,B,$,z,I,T,M,V;function m(e,t,i,s){!i||Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(s):void 0})}function d(e,t,i){return t=be(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function be(e){var t=ve(e,"string");return typeof t=="symbol"?t:String(t)}function ve(e,t){if(typeof e!="object"||e===null)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var s=i.call(e,t||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function h(e,t,i,s,a){var r={};return Object.keys(s).forEach(function(n){r[n]=s[n]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce(function(n,b){return b(e,t,n)||n},r),a&&r.initializer!==void 0&&(r.value=r.initializer?r.initializer.call(a):void 0,r.initializer=void 0),r.initializer===void 0&&(Object.defineProperty(e,t,r),r=null),r}const R=window.ReactDOM,F={array:[{id:"1",name:"length"}],string:[{id:"2",name:"length"},{id:"3",name:"toLocaleLowerCase"},{id:"4",name:"toLocaleUpperCase"}]};let ge=(l=class{constructor(){m(this,"buildList",B,this),d(this,"getDefault",()=>{}),d(this,"dom",document.createElement("div")),d(this,"createReactDOM",()=>{R.render(o(me,{store:this}),this.dom)}),d(this,"removeReactDOM",()=>{R.unmountComponentAtNode(this.dom)}),m(this,"visible",$,this),m(this,"openDialog",z,this),m(this,"closeDialog",I,this),d(this,"dataSource",{}),d(this,"dataSchema",{type:"object",properties:{}}),d(this,"promise",null),d(this,"init",(t={},i={type:"object",properties:{}})=>{this.dataSource=t,this.dataSchema=i;const s=this.getBuildList(this.dataSource,[]);return s&&(this.buildList=[s]),new Promise((a,r)=>{this.promise={resolve:a,reject:r},this.openDialog()})}),d(this,"getBuildList",(t,i)=>{switch(typeof t){case"string":return{id:p(),varsList:[{id:p(),field:"length"}]};case"object":if(t){const s=Object.keys(t),a={id:p(),varsList:[],methodList:[]};for(const r of s){const n=H(this.dataSchema,[...i,r]);a.varsList.push({id:p(),field:r,schema:n}),t[r]&&typeof t[r]=="function"&&a.methodList.push({schema:n,id:p(),name:`${r}()`})}return Array.isArray(t)&&a.varsList.unshift({id:p(),field:"length"}),a}}return{id:p(),varsList:[]}}),d(this,"getMethods",t=>{switch(typeof t){case"object":if(Array.isArray(t))return F.array;case"boolean":return[];case"number":case"string":return F.string}return[]}),m(this,"selecteds",T,this),d(this,"getSelectedPaths",t=>t.map(i=>i.name)),m(this,"addSelectedVars",M,this),m(this,"addSelectedMethod",V,this)}get expressionText(){return`\${ ${this.getSelectedPaths(this.selecteds).map(i=>`\`${i}\``).join(".")} }`}get data(){return U(this.expressionText,this.dataSource)}get dataText(){return typeof this.data=="object"?JSON.stringify(this.data,null,"	"):String(this.data)}},B=h(l.prototype,"buildList",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$=h(l.prototype,"visible",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),z=h(l.prototype,"openDialog",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return()=>{this.visible=!0,this.createReactDOM()}}}),I=h(l.prototype,"closeDialog",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return()=>{this.visible=!1,this.removeReactDOM(),this.promise=null}}}),T=h(l.prototype,"selecteds",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),h(l.prototype,"expressionText",[w],Object.getOwnPropertyDescriptor(l.prototype,"expressionText"),l.prototype),h(l.prototype,"data",[w],Object.getOwnPropertyDescriptor(l.prototype,"data"),l.prototype),h(l.prototype,"dataText",[w],Object.getOwnPropertyDescriptor(l.prototype,"dataText"),l.prototype),M=h(l.prototype,"addSelectedVars",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return(e,t)=>{const i=this.selecteds;i.splice(e);const s=this.buildList;s.splice(e+1),i.push({type:"var",id:t.id,name:`${t.field}`});const a=this.getSelectedPaths(i),r=q.exports.get(this.dataSource,a),n=this.getBuildList(r,a);n&&s.push(n),this.selecteds=[...i],this.buildList=s,console.log("buildList",P(s),P(i))}}}),V=h(l.prototype,"addSelectedMethod",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return(e,t)=>{const i=this.selecteds;i.splice(e);const s=this.buildList;s.splice(e+1),i.push({type:"var",id:t.id,name:t.name}),this.selecteds=[...i],this.buildList=s}}}),l);var A=ge;const _e=window.React.cloneElement;var Le=e=>o(k.Consumer,{children:t=>e.children?_e(e.children,{onClick:async()=>{const i=typeof t=="function"?t():t;new A().init(i.data,i.dataSchema).then(a=>{e.onChange&&e.onChange(a)})}}):o(J,{style:{cursor:"pointer"},onClick:async()=>{const i=typeof t=="function"?t():t;new A().init(i.data,i.dataSchema).then(a=>{e.onChange&&e.onChange(a)})}})}),Se=e=>o(K,ee(O({},e),{addAfter:o(G,{onChange:({value:t})=>{e.onChange&&e.onChange(`${e.value||""}${t}`,{})}})}));export{Se as ExpressionBuilderInput,Le as ExpressionBuilderTrigger};
